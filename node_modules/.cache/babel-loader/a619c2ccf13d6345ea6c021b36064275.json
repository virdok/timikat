{"ast":null,"code":"import _asyncToGenerator from \"/home/dkirchan/timikat/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _slicedToArray from \"/home/dkirchan/timikat/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _objectSpread from \"/home/dkirchan/timikat/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\n\nvar _jsxFileName = \"/home/dkirchan/timikat/src/contexts/JWTContext.js\",\n    _s = $RefreshSig$();\n\nimport _regeneratorRuntime from \"/home/dkirchan/timikat/node_modules/@babel/runtime/regenerator/index.js\";\nimport { createContext, useEffect, useReducer } from \"react\";\nimport axios from \"../utils/axios\";\nimport { isValidToken, setSession } from \"../utils/jwt\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar INITIALIZE = \"INITIALIZE\";\nvar SIGN_IN = \"SIGN_IN\";\nvar SIGN_OUT = \"SIGN_OUT\";\nvar SIGN_UP = \"SIGN_UP\";\nvar initialState = {\n  isAuthenticated: false,\n  isInitialized: false,\n  user: null\n};\n\nvar JWTReducer = function JWTReducer(state, action) {\n  switch (action.type) {\n    case INITIALIZE:\n      return {\n        isAuthenticated: action.payload.isAuthenticated,\n        isInitialized: true,\n        user: action.payload.user\n      };\n\n    case SIGN_IN:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        isAuthenticated: true,\n        user: action.payload.user\n      });\n\n    case SIGN_OUT:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        isAuthenticated: false,\n        user: null\n      });\n\n    case SIGN_UP:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        isAuthenticated: true,\n        user: action.payload.user\n      });\n\n    default:\n      return state;\n  }\n};\n\n_c = JWTReducer;\nvar AuthContext = /*#__PURE__*/createContext(null);\n\nfunction AuthProvider(_ref) {\n  _s();\n\n  var children = _ref.children;\n\n  var _useReducer = useReducer(JWTReducer, initialState),\n      _useReducer2 = _slicedToArray(_useReducer, 2),\n      state = _useReducer2[0],\n      dispatch = _useReducer2[1];\n\n  useEffect(function () {\n    var initialize = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var accessToken, response, user;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                accessToken = window.localStorage.getItem(\"accessToken\");\n\n                if (!(accessToken && isValidToken(accessToken))) {\n                  _context.next = 11;\n                  break;\n                }\n\n                setSession(accessToken);\n                _context.next = 6;\n                return axios.get(\"/api/auth/my-account\");\n\n              case 6:\n                response = _context.sent;\n                user = response.data.user;\n                dispatch({\n                  type: INITIALIZE,\n                  payload: {\n                    isAuthenticated: true,\n                    user: user\n                  }\n                });\n                _context.next = 12;\n                break;\n\n              case 11:\n                dispatch({\n                  type: INITIALIZE,\n                  payload: {\n                    isAuthenticated: false,\n                    user: null\n                  }\n                });\n\n              case 12:\n                _context.next = 18;\n                break;\n\n              case 14:\n                _context.prev = 14;\n                _context.t0 = _context[\"catch\"](0);\n                console.error(_context.t0);\n                dispatch({\n                  type: INITIALIZE,\n                  payload: {\n                    isAuthenticated: false,\n                    user: null\n                  }\n                });\n\n              case 18:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[0, 14]]);\n      }));\n\n      return function initialize() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    initialize();\n  }, []);\n\n  var signIn = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(email, password) {\n      var response, _response$data, accessToken, user;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return axios.post(\"/api/auth/sign-in\", {\n                email: email,\n                password: password\n              });\n\n            case 2:\n              response = _context2.sent;\n              _response$data = response.data, accessToken = _response$data.accessToken, user = _response$data.user;\n              setSession(accessToken);\n              dispatch({\n                type: SIGN_IN,\n                payload: {\n                  user: user\n                }\n              });\n\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function signIn(_x, _x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var signOut = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              setSession(null);\n              dispatch({\n                type: SIGN_OUT\n              });\n\n            case 2:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function signOut() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var signUp = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(email, password, firstName, lastName) {\n      var response, _response$data2, accessToken, user;\n\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return axios.post(\"/api/auth/sign-up\", {\n                email: email,\n                password: password,\n                firstName: firstName,\n                lastName: lastName\n              });\n\n            case 2:\n              response = _context4.sent;\n              _response$data2 = response.data, accessToken = _response$data2.accessToken, user = _response$data2.user;\n              window.localStorage.setItem(\"accessToken\", accessToken);\n              dispatch({\n                type: SIGN_UP,\n                payload: {\n                  user: user\n                }\n              });\n\n            case 6:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function signUp(_x3, _x4, _x5, _x6) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  var resetPassword = function resetPassword(email) {\n    return console.log(email);\n  };\n\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: _objectSpread(_objectSpread({}, state), {}, {\n      method: \"jwt\",\n      signIn: signIn,\n      signOut: signOut,\n      signUp: signUp,\n      resetPassword: resetPassword\n    }),\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 139,\n    columnNumber: 5\n  }, this);\n}\n\n_s(AuthProvider, \"bgCdjuTOmPdSBRwTap80EFd9Y3U=\");\n\n_c2 = AuthProvider;\nexport { AuthContext, AuthProvider };\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"JWTReducer\");\n$RefreshReg$(_c2, \"AuthProvider\");","map":{"version":3,"sources":["/home/dkirchan/timikat/src/contexts/JWTContext.js"],"names":["createContext","useEffect","useReducer","axios","isValidToken","setSession","INITIALIZE","SIGN_IN","SIGN_OUT","SIGN_UP","initialState","isAuthenticated","isInitialized","user","JWTReducer","state","action","type","payload","AuthContext","AuthProvider","children","dispatch","initialize","accessToken","window","localStorage","getItem","get","response","data","console","error","signIn","email","password","post","signOut","signUp","firstName","lastName","setItem","resetPassword","log","method"],"mappings":"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","sourcesContent":["import { createContext, useEffect, useReducer } from \"react\";\r\n\r\nimport axios from \"../utils/axios\";\r\nimport { isValidToken, setSession } from \"../utils/jwt\";\r\n\r\nconst INITIALIZE = \"INITIALIZE\";\r\nconst SIGN_IN = \"SIGN_IN\";\r\nconst SIGN_OUT = \"SIGN_OUT\";\r\nconst SIGN_UP = \"SIGN_UP\";\r\n\r\nconst initialState = {\r\n  isAuthenticated: false,\r\n  isInitialized: false,\r\n  user: null,\r\n};\r\n\r\nconst JWTReducer = (state, action) => {\r\n  switch (action.type) {\r\n    case INITIALIZE:\r\n      return {\r\n        isAuthenticated: action.payload.isAuthenticated,\r\n        isInitialized: true,\r\n        user: action.payload.user,\r\n      };\r\n    case SIGN_IN:\r\n      return {\r\n        ...state,\r\n        isAuthenticated: true,\r\n        user: action.payload.user,\r\n      };\r\n    case SIGN_OUT:\r\n      return {\r\n        ...state,\r\n        isAuthenticated: false,\r\n        user: null,\r\n      };\r\n\r\n    case SIGN_UP:\r\n      return {\r\n        ...state,\r\n        isAuthenticated: true,\r\n        user: action.payload.user,\r\n      };\r\n\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nconst AuthContext = createContext(null);\r\n\r\nfunction AuthProvider({ children }) {\r\n  const [state, dispatch] = useReducer(JWTReducer, initialState);\r\n\r\n  useEffect(() => {\r\n    const initialize = async () => {\r\n      try {\r\n        const accessToken = window.localStorage.getItem(\"accessToken\");\r\n\r\n        if (accessToken && isValidToken(accessToken)) {\r\n          setSession(accessToken);\r\n\r\n          const response = await axios.get(\"/api/auth/my-account\");\r\n          const { user } = response.data;\r\n\r\n          dispatch({\r\n            type: INITIALIZE,\r\n            payload: {\r\n              isAuthenticated: true,\r\n              user,\r\n            },\r\n          });\r\n        } else {\r\n          dispatch({\r\n            type: INITIALIZE,\r\n            payload: {\r\n              isAuthenticated: false,\r\n              user: null,\r\n            },\r\n          });\r\n        }\r\n      } catch (err) {\r\n        console.error(err);\r\n        dispatch({\r\n          type: INITIALIZE,\r\n          payload: {\r\n            isAuthenticated: false,\r\n            user: null,\r\n          },\r\n        });\r\n      }\r\n    };\r\n\r\n    initialize();\r\n  }, []);\r\n\r\n  const signIn = async (email, password) => {\r\n    const response = await axios.post(\"/api/auth/sign-in\", {\r\n      email,\r\n      password,\r\n    });\r\n    const { accessToken, user } = response.data;\r\n\r\n    setSession(accessToken);\r\n    dispatch({\r\n      type: SIGN_IN,\r\n      payload: {\r\n        user,\r\n      },\r\n    });\r\n  };\r\n\r\n  const signOut = async () => {\r\n    setSession(null);\r\n    dispatch({ type: SIGN_OUT });\r\n  };\r\n\r\n  const signUp = async (email, password, firstName, lastName) => {\r\n    const response = await axios.post(\"/api/auth/sign-up\", {\r\n      email,\r\n      password,\r\n      firstName,\r\n      lastName,\r\n    });\r\n    const { accessToken, user } = response.data;\r\n\r\n    window.localStorage.setItem(\"accessToken\", accessToken);\r\n    dispatch({\r\n      type: SIGN_UP,\r\n      payload: {\r\n        user,\r\n      },\r\n    });\r\n  };\r\n\r\n  const resetPassword = (email) => console.log(email);\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        ...state,\r\n        method: \"jwt\",\r\n        signIn,\r\n        signOut,\r\n        signUp,\r\n        resetPassword,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport { AuthContext, AuthProvider };\r\n"]},"metadata":{},"sourceType":"module"}